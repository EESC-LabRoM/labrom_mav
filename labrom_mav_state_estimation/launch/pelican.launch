<launch>
  <!-- <arg name="robot_name" value="fcu" /> -->

	<!-- ######################## STATIC TRANSFORMS ##########################	-->
  <node pkg="tf" type="static_transform_publisher" name="base_imu_transform" args="0 0 0 0 0 0 base_link imu_link 1000" ns="tf"/>
  <node pkg="tf" type="static_transform_publisher" name="base_camera_transform" args="0 0 -0.06 -1.5708 0 3.1416 base_link camera_link 1000" ns="tf" />
  <node pkg="tf" type="static_transform_publisher" name="world_tag_0_transform" args="0 0 0 0 0 0 tag_0 world 1000" ns="tf"/>

	<!-- ######################## IMAGE PROC ######################## -->
  <node name="image_proc" pkg="labrom_sensors" type="image_proc_node">
    <remap from="image_raw/compressed" to="camera/image_raw/compressed"/>
    <remap from="image_mono" to="camera/image_mono"/>

    <param name="image_transport" value="compressed"/>
    <param name="encoding" value="rgb8"/>
  </node>
	<!-- ######################## PERCEPTION NODES ######################## -->
	<!-- ************ OPTICAL FLOW ************ -->
  <node name="optical_flow" type="continuous_homography_node" pkg="labrom_optical_flow" output="screen">
    <rosparam file="$(find labrom_mav_state_estimation)/params/pelican/optical_flow.yaml" />
     <!-- Subscribers -->
     <remap from="camera/camera_info" to="camera/camera_info"/>
  	 <remap from="camera/image_mono" to="camera/image_mono"/>
		 <remap from="odometry" to="ekf/odometry/odom"/>
     <!-- Publishers  -->
		 <remap from="optical_flow/odometry" to="optical_flow/odometry"/>
		 <remap from="optical_flow/image" to="optical_flow/image"/>  
  </node>

  <!-- ************ APRILTAGS ************ 
	<node pkg="apriltags_ros" type="apriltag_detector_node" name="apriltag" output="screen"> -->
    <!-- Remap topics 
    <remap from="image_rect" to="camera/image_raw"/>
    <remap from="tag_detections_image" to="apriltag/image"/>
    <remap from="tag_detections_pose_covariance" to="apriltag/pose"/>   --> 
		<!-- Parameters  
    <rosparam  command="load" file="$(find labrom_mav_state_estimation)/params/pelican/april_tags.yaml" />-->
    <!-- Describe the tags 
    <rosparam param="tag_descriptions">[
      {id: 0, size: 0.16351}
    ]</rosparam>
	</node>-->

	<!-- ######################## FILTERING ######################## -->
  <node pkg="robot_localization" type="ekf_localization_node" name="ekf_odom" clear_params="true">
		<!-- remap-->
		<remap from="/odom0" to ="optical_flow/odometry"/>
		<remap from="/imu0"  to ="fcu/imu"/>
		<remap from="odometry/filtered" to="ekf/odometry/odom"/> 
		<!-- Parameters -->
    <rosparam command="load" file="$(find labrom_mav_state_estimation)/params/pelican/ekf_odom.yaml" />
  </node> 
	<!--
  <node pkg="robot_localization" type="ekf_localization_node" name="ekf_world" clear_params="true">
	 remap
		<remap from="/odom0" to="ekf/odometry/odom"/>
		<remap from="/pose0" to="apriltag/pose"/>
		<remap from="odometry/filtered" to="ekf/odometry/world"/> -->
	  <!-- Parameters 
    <rosparam command="load" file="$(find labrom_mav_state_estimation)/params/pelican/ekf_landmark.yaml" />
  </node>--> 


</launch>

